<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>الوسيط للشحن – لوحة التحكم الاحترافية</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2563eb;
            --primary-hover: #1d4ed8;
            --secondary: #10b981;
            --danger: #ef4444;
            --dark: #0f172a;
            --light: #f8fafc;
            --card-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            --bg-color: #f1f5f9;
            --text-color: #1e293b;
            --card-bg: white;
            --header-bg: rgba(255, 255, 255, 0.9);
            --input-bg: #f8fafc;
            --border-color: #e2e8f0;
            --table-header-bg: #f8fafc;
            --footer-bg: var(--dark);
            --footer-text: white;
        }

        [data-theme="dark"] {
            --bg-color: #0f172a;
            --text-color: #e2e8f0;
            --card-bg: #1e293b;
            --header-bg: rgba(30, 41, 59, 0.9);
            --input-bg: #334155;
            --border-color: #475569;
            --table-header-bg: #1e293b;
            --footer-bg: #020617;
            --footer-text: #cbd5e1;
            --card-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Tajawal', sans-serif; background: var(--bg-color); color: var(--text-color); transition: 0.3s; min-height: 100vh; display: flex; flex-direction: column; }

        .theme-toggle { position: fixed; bottom: 20px; left: 20px; width: 50px; height: 50px; border-radius: 50%; background: var(--primary); color: white; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; z-index: 1000; box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3); transition: 0.3s; }
        .theme-toggle:hover { transform: scale(1.1); }

        header { background: var(--header-bg); backdrop-filter: blur(12px); padding: 15px 5%; position: sticky; top: 0; z-index: 1000; box-shadow: 0 1px 3px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
        .brand { display: flex; align-items: center; gap: 12px; }
        .brand img { height: 45px; width: 45px; border-radius: 12px; object-fit: cover; border: 2px solid var(--primary); }
        .brand h1 { font-size: 1.2rem; font-weight: 800; }

        nav { display: flex; gap: 8px; }
        nav button { background: transparent; border: none; padding: 10px 18px; border-radius: 12px; cursor: pointer; font-family: inherit; font-weight: 600; color: #64748b; display: flex; align-items: center; gap: 8px; transition: 0.2s; }
        nav button.active { background: var(--primary); color: white; }

        main { padding: 30px 5%; max-width: 1400px; margin: 0 auto; width: 100%; flex: 1; }
        .page { display: none; animation: slideUp 0.4s ease-out; }
        .page.active { display: block; }

        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: var(--card-bg); padding: 28px; border-radius: 24px; box-shadow: var(--card-shadow); margin-bottom: 30px; border: 1px solid var(--border-color); }
        .card h3 { margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }

        .grid-form { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 700; font-size: 0.9rem; color: #64748b; }
        input, select { width: 100%; padding: 14px; border: 2px solid var(--border-color); border-radius: 12px; font-family: inherit; background: var(--input-bg); color: var(--text-color); outline: none; }
        input:focus { border-color: var(--primary); }

        .btn-save { margin-top: 20px; width: 100%; padding: 15px; border-radius: 12px; border: none; background: var(--secondary); color: white; font-weight: 700; cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-save:hover { filter: brightness(1.1); transform: translateY(-2px); }

        .table-container { background: var(--card-bg); border-radius: 16px; overflow-x: auto; border: 1px solid var(--border-color); }
        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th { background: var(--table-header-bg); padding: 16px; text-align: center; border-bottom: 2px solid var(--border-color); color: #64748b; }
        td { padding: 16px; border-bottom: 1px solid var(--border-color); text-align: center; }

        .type-badge { padding: 5px 12px; border-radius: 8px; font-size: 0.85rem; font-weight: 600; }
        .export-bg { background: rgba(16, 185, 129, 0.1); color: #10b981; }
        .import-bg { background: rgba(37, 99, 235, 0.1); color: #2563eb; }

        .delete-btn { background: #fee2e2; color: var(--danger); border: none; padding: 8px 14px; border-radius: 8px; cursor: pointer; }
        .delete-btn:hover { background: var(--danger); color: white; }

        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 25px; }
        .stat-item { background: var(--card-bg); padding: 20px; border-radius: 20px; text-align: center; border: 1px solid var(--border-color); }
        .stat-item.net { background: var(--dark); color: white; }

        footer { background: var(--footer-bg); color: var(--footer-text); padding: 40px 5%; text-align: center; margin-top: 40px; }
        .social-links a { color: var(--footer-text); font-size: 1.5rem; margin: 0 10px; }

        /* Styles for Services Page */
        .features { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-top: 30px; }
        .feature { background: var(--input-bg); padding: 25px; border-radius: 16px; text-align: center; transition: 0.3s; cursor: pointer; border: 1px solid var(--border-color); }
        .feature:hover { transform: translateY(-5px); box-shadow: var(--card-shadow); }
        .feature img { width: 60px; margin-bottom: 15px; }

        .wa-popup { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 2000; padding: 20px; }
        .wa-box { background: var(--card-bg); padding: 30px; border-radius: 24px; width: 100%; max-width: 400px; text-align: center; }
        .wa-btn { display: block; background: #25D366; color: white; padding: 15px; border-radius: 12px; margin: 10px 0; text-decoration: none; font-weight: bold; }

        @media (max-width: 768px) {
            header { flex-direction: column; gap: 15px; }
            nav { width: 100%; overflow-x: auto; padding-bottom: 5px; }
        }
    </style>
</head>
<body>

    <button class="theme-toggle" id="themeToggle" title="تبديل الوضع">
        <i class="fas fa-moon"></i>
    </button>

    <header>
        <div class="brand">
            <img src="logo.png" alt="الوسيط" onerror="this.src='https://ui-avatars.com/api/?name=W&background=2563eb&color=fff'">
            <h1>الوسيط للشحن</h1>
        </div>
        <nav>
            <button onclick="showPage('main-page')" id="btn-main" class="active"><i class="fas fa-th-large"></i> لوحة التحكم</button>
            <button onclick="showPage('elwaset-page')" id="btn-elwaset"><i class="fas fa-truck-fast"></i> خدماتنا</button>
            <button onclick="showPage('about-page')" id="btn-about"><i class="fas fa-info-circle"></i> عن الشركة</button>
        </nav>
    </header>

    <main>
        <section id="main-page" class="page active">
            <div class="card">
                <h3><i class="fas fa-file-invoice" style="color: var(--primary);"></i> تسجيل شحنة جديدة</h3>
                <div class="grid-form">
                    <div class="form-group"><label>رقم الشحنة</label><input id="orderId" type="text" placeholder="SH-1001"></div>
                    <div class="form-group"><label>اسم العميل</label><input id="customer" type="text" placeholder="الاسم ثلاثي"></div>
                    <div class="form-group"><label>الشركة</label><input id="category" type="text" placeholder="اسم المتجر"></div>
                    <div class="form-group">
                        <label>الوجهة</label>
                        <select id="governorate">
                            <option value="">-- اختر المحافظة --</option>
                            <option>الفيوم</option><option>بني سويف</option><option>المنيا</option>
                            <option>أسيوط</option><option>سوهاج</option><option>قنا</option>
                            <option>الأقصر</option><option>أسوان</option><option>الغردقة</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>نوع العملية</label>
                        <select id="type">
                            <option value="صادرات">صادرات (توصيل)</option>
                            <option value="واردات">واردات (مرتجع)</option>
                        </select>
                    </div>
                    <div class="form-group"><label>المبلغ</label><input id="price" type="number" placeholder="0.00"></div>
                </div>
                <button onclick="addOrder()" id="saveBtn" class="btn-save"><i class="fas fa-check-circle"></i> تأكيد وحفظ الشحنة</button>
            </div>

            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; margin-bottom: 20px;">
                    <h3><i class="fas fa-boxes-stacked" style="color: var(--primary);"></i> السجل التاريخي</h3>
                    <div style="position: relative; width: 300px;">
                        <i class="fas fa-search" style="position: absolute; right: 15px; top: 15px; color: #94a3b8;"></i>
                        <input id="search" placeholder="بحث باسم العميل أو الكود..." onkeyup="filterOrders()" style="padding-right: 40px;">
                    </div>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>الكود</th>
                                <th>العميل</th>
                                <th>الشركة</th>
                                <th>المحافظة</th>
                                <th>النوع</th>
                                <th>المبلغ</th>
                                <th>الإجراء</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody"></tbody>
                    </table>
                </div>

                <div class="stats">
                    <div class="stat-item"><h4>إجمالي الصادرات</h4><p id="totalExports">0 ج.م</p></div>
                    <div class="stat-item"><h4>إجمالي الواردات</h4><p id="totalImports">0 ج.م</p></div>
                    <div class="stat-item net"><h4>صافي التحصيل</h4><p id="netProfit">0 ج.م</p></div>
                </div>
            </div>
        </section>

        <section id="elwaset-page" class="page">
            <div class="card" style="text-align:center;">
                <h2 style="color:var(--primary)">الوسيط للشحن … السرعة التي تريحك</h2>
                <p style="margin-bottom:30px; opacity:0.8;">حلول لوجستية متكاملة لخدمة أصحاب الأعمال في الصعيد</p>
                <div class="features">
                    <div class="feature"><img src="https://cdn-icons-png.flaticon.com/512/1048/1048315.png"><h3>توصيل سريع</h3><p>خلال 24-48 ساعة عمل</p></div>
                    <div class="feature"><img src="https://cdn-icons-png.flaticon.com/512/833/833593.png"><h3>أمان تام</h3><p>تأمين شامل على الطرود</p></div>
                    <div class="feature" onclick="openWhatsAppPopup()"><img src="https://cdn-icons-png.flaticon.com/512/1828/1828817.png"><h3>دعم فني</h3><p>متواجدون لخدمتكم دائماً</p></div>
                </div>
            </div>
        </section>

        <section id="about-page" class="page">
            <div class="card" style="text-align: center;">
                <img src="2.png" alt="الوسيط" style="max-width: 100%; border-radius: 20px;" onerror="this.src='https://via.placeholder.com/800x400?text=Al-Waset+Shipping'">
                <p style="margin-top:20px; font-size:1.1rem;">نحن شركة الوسيط، رواد الشحن في منطقة الصعيد والبحر الأحمر، نسعى دائماً لتقديم أفضل تجربة شحن لعملائنا.</p>
            </div>
        </section>
    </main>

    <div class="wa-popup" id="waPopup">
        <div class="wa-box">
            <h3>تواصل معنا مباشرة</h3>
            <a class="wa-btn" href="https://wa.me/201028281203" target="_blank">خدمة العملاء 1</a>
            <a class="wa-btn" href="https://wa.me/201005558289" target="_blank">خدمة العملاء 2</a>
            <button onclick="closeWhatsAppPopup()" style="background:none; border:none; color:#64748b; cursor:pointer; margin-top:10px;">إغلاق</button>
        </div>
    </div>

    <footer>
        <div class="social-links">
            <a href="https://www.facebook.com/share/1B2gBAgmxS/"><i class="fab fa-facebook"></i></a>
            <a href="https://wa.me/201028281203"><i class="fab fa-whatsapp"></i></a>
        </div>
        <p style="margin-top:15px;">© 2025 الوسيط للشحن - جميع الحقوق محفوظة</p>
    </footer>

    <script>
        // UI Logic
        const html = document.documentElement;
        const themeToggle = document.getElementById('themeToggle');
        
        function updateThemeIcon() {
            const isDark = html.getAttribute('data-theme') === 'dark';
            themeToggle.innerHTML = isDark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
        }

        themeToggle.addEventListener('click', () => {
            const current = html.getAttribute('data-theme');
            const target = current === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', target);
            localStorage.setItem('theme', target);
            updateThemeIcon();
        });

        if (localStorage.getItem('theme') === 'dark') {
            html.setAttribute('data-theme', 'dark');
            updateThemeIcon();
        }

        function showPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.getElementById('btn-' + id.split('-')[0]).classList.add('active');
            window.scrollTo(0,0);
        }

        function openWhatsAppPopup() { document.getElementById("waPopup").style.display = "flex"; }
        function closeWhatsAppPopup() { document.getElementById("waPopup").style.display = "none"; }
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDndL_0CFyoY8HCTQgiad502NkxrjJazl4",
            authDomain: "elwaset-99cfa.firebaseapp.com",
            projectId: "elwaset-99cfa",
            storageBucket: "elwaset-99cfa.firebasestorage.app",
            messagingSenderId: "1074967858040",
            appId: "1:1074967858040:web:23124e26636ccc8f95168d"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let allOrders = []; // لعمل الفلترة محلياً لتحسين السرعة

        // إضافة شحنة
        window.addOrder = async function () {
            const idInput = document.getElementById('orderId');
            const customerInput = document.getElementById('customer');
            const priceInput = document.getElementById('price');
            const saveBtn = document.getElementById('saveBtn');

            if (!idInput.value || !customerInput.value) {
                alert("برجاء ملء البيانات الأساسية (رقم الشحنة واسم العميل)");
                return;
            }

            const data = {
                id: idInput.value,
                customer: customerInput.value,
                category: document.getElementById('category').value,
                governorate: document.getElementById('governorate').value,
                type: document.getElementById('type').value,
                price: Number(priceInput.value) || 0,
                createdAt: serverTimestamp()
            };

            try {
                saveBtn.disabled = true;
                saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري الحفظ...';
                await addDoc(collection(db, "orders"), data);
                idInput.value = ''; customerInput.value = ''; priceInput.value = '';
            } catch (e) {
                alert("خطأ في الاتصال بالقاعدة");
            } finally {
                saveBtn.disabled = false;
                saveBtn.innerHTML = '<i class="fas fa-check-circle"></i> تأكيد وحفظ الشحنة';
            }
        };

        // حذف شحنة
        window.deleteOrder = async function (docId) {
            if (confirm("هل تريد حذف هذه الشحنة نهائياً؟")) {
                await deleteDoc(doc(db, "orders", docId));
            }
        };

        // جلب البيانات لحظياً (Real-time)
        const q = query(collection(db, "orders"), orderBy("createdAt", "desc"));
        onSnapshot(q, (snapshot) => {
            allOrders = snapshot.docs.map(doc => ({ uid: doc.id, ...doc.data() }));
            renderTable(allOrders);
        });

        window.renderTable = function (orders) {
            const tbody = document.getElementById("tableBody");
            let ex = 0, im = 0;
            tbody.innerHTML = "";

            orders.forEach(o => {
                if (o.type === "صادرات") ex += o.price; else im += o.price;

                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td style="color:var(--primary); font-weight:bold">${o.id}</td>
                    <td>${o.customer}</td>
                    <td>${o.category || '-'}</td>
                    <td>${o.governorate}</td>
                    <td><span class="type-badge ${o.type==='صادرات'?'export-bg':'import-bg'}">${o.type}</span></td>
                    <td style="font-weight:700">${o.price.toLocaleString()} ج.م</td>
                    <td><button class="delete-btn" onclick="deleteOrder('${o.uid}')"><i class="fas fa-trash"></i></button></td>
                `;
                tbody.appendChild(tr);
            });

            document.getElementById("totalExports").innerText = ex.toLocaleString() + " ج.م";
            document.getElementById("totalImports").innerText = im.toLocaleString() + " ج.م";
            document.getElementById("netProfit").innerText = (ex - im).toLocaleString() + " ج.م";
        };

        // فلترة البحث
        window.filterOrders = function () {
            const term = document.getElementById("search").value.toLowerCase();
            const filtered = allOrders.filter(o => 
                o.customer.toLowerCase().includes(term) || 
                o.id.toLowerCase().includes(term)
            );
            renderTable(filtered);
        };
    </script>
</body>
</html>
